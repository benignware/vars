@function vars--map-flatten($map, $delimiter: '-', $recursive: true, $prefix: '') {
  $result: ();

  @each $name, $value in $map {
    @if ($recursive and type-of($value) == 'map') {
      $result: map-merge($result, vars--map-flatten($value, $delimiter: $delimiter, $prefix: '#{$name}#{$delimiter}'));
    } @else {
      $result: map-merge($result, (
        #{$prefix}#{$name}: #{$value}
      ));
    }
  }

  @return $result;
}
